<html>
  <head>
    <title>Canvas Boilerplate</title>

    <style type="text/css">
      *,html{
        margin: 0;padding: 0;
      }
      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body onload="setup();">
    <canvas id="canvas"></canvas>
    <script type="text/javascript">
      /* GLOBAL */
      window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

      var particles = [];

      var global_width = window.innerWidth,
          global_height = window.innerHeight,
          ratio = 1,
          canvas = document.getElementById('canvas'),
          ctx = canvas.getContext('2d');

      function randomIntFromInterval(min,max)
      {
          return Math.floor(Math.random()*(max-min+1)+min);
      }

      /* SETUP */
      function setup(){
        if (ctx){
          init();
          requestAnimationFrame(update);
          window.addEventListener('resize', rescale);
          rescale();
        }
      }

      function rescale(){
        global_width = window.innerWidth;
        global_height = window.innerHeight;
        if(ctx.webkitBackingStorePixelRatio < 2) ratio = window.devicePixelRatio || 1;
        canvas.setAttribute('width', global_width*ratio);
        canvas.setAttribute('height', global_height*ratio);
        resetParticles();
        draw();
      }


      function resetParticles(){
        particles = [];
        for(var i=0; i < 20; i++){
          addNewPoint();
        }
      }

      /* INIT */
      function init(){
        resetParticles();
        draw();
      }

function calcCrow(lat1, lon1, lat2, lon2)
    {
      var R = 6371; // km
      var dLat = toRad(lat2-lat1);
      var dLon = toRad(lon2-lon1);
      var lat1 = toRad(lat1);
      var lat2 = toRad(lat2);

      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2);
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      var d = R * c;
      return d;
    }

 function toRad(Value)
    {
        return Value * Math.PI / 180;
    }

      /* DRAW */
      function drawExample(){
        particles.forEach(function(particle){
          ctx.beginPath();
          ctx.arc(particle.x, particle.y, particle.scale, 0, Math.PI*2, true);
          ctx.closePath();
          ctx.fill();

          particles.forEach(function(particleTwo){

            var distance = calcCrow(particle.x, particle.y, particleTwo.x, particleTwo.y);

            if(distance < 10000) {
              ctx.beginPath();
              ctx.moveTo(particle.x,particle.y);
              ctx.lineTo(particleTwo.x,particleTwo.y);
              ctx.lineWidth = distance/10000;
              ctx.stroke();
            }
          });

        if(particle.x > global_width || particle.x < 0){
          var index = particles.indexOf(particle);
          if (index > -1) {
            particles.splice(index, 1);
            addNewPoint();
          }
        }
        if(particle.y > global_height || particle.y < 0){
          var index = particles.indexOf(particle);
          if (index > -1) {
            particles.splice(index, 1);
            addNewPoint();
          }
        }

        particle.x += (particle.dx*particle.speed);
        particle.y += (particle.dy*particle.speed);

        });
      }

      function addNewPoint(){
        var dx = Math.random()-Math.random();
        var dy = Math.random()-Math.random();
        var speed = Math.random()+1;

        var x = randomIntFromInterval(0,global_width)
        var y = randomIntFromInterval(0,global_height)
        var scale = 1;
        particles.push({x:x, y:y, dx:dx, dy:dy, scale:scale, speed:speed});
      }

      function draw(){
        ctx.save();
        ctx.scale(ratio, ratio);
        // Execute your draw specific functions between the lines to enable high-dpi drawing
        // ---------------------------------------------------------------------------------
        ctx.clearRect(0, 0, global_width, global_height);
        drawExample();
        // ---------------------------------------------------------------------------------
        ctx.restore();
      }

      /* UPDATE */
      function update(){
        requestAnimationFrame(update);
        draw();
      }
    </script>
  </body>
</html>
